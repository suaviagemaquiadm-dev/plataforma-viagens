<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Parceiro - Sua Viagem Aqui</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0D1117;
            color: #E6EDF3; 
        }
        .bg-custom-card { background-color: #161B22; }
        .border-custom { border-color: #30363D; }
        .btn-contact {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .btn-contact:hover { opacity: 0.9; }
        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; }
        .btn-phone { background-color: #3498db; color: white; }
        #page-content { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Indicador de Carregamento -->
    <div id="loader" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin text-4xl text-orange-500"></i>
            <p class="mt-4 text-lg">A carregar perfil do parceiro...</p>
        </div>
    </div>

    <!-- Conteúdo da Página (inicialmente escondido) -->
    <div id="page-content">
        <header class="bg-custom-card/80 backdrop-blur-lg sticky top-0 z-50 border-b border-custom">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <a href="/" class="flex items-center group">
                    <i class="fas fa-map-marker-alt text-yellow-400 text-2xl mr-3"></i>
                    <span class="text-xl font-bold text-white">Sua Viagem <span class="text-orange-500">Aqui</span></span>
                </a>
                <a href="/#search-section" class="text-gray-300 hover:text-white font-medium transition-colors">Nova Busca</a>
            </div>
        </header>

        <main id="profile-container" class="container mx-auto p-4 md:p-8">
            <!-- O conteúdo do perfil será inserido aqui pelo JavaScript -->
        </main>
    </div>

    <!-- Template para Perfil Não Encontrado -->
    <template id="not-found-template">
        <div class="text-center py-20">
            <i class="fas fa-exclamation-triangle text-6xl text-orange-500 mb-4"></i>
            <h1 class="text-3xl font-bold text-white">Parceiro não Encontrado</h1>
            <p class="text-gray-400 mt-2">O perfil que está a tentar aceder não existe ou foi removido.</p>
            <a href="/" class="mt-6 inline-block bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                Voltar à Página Inicial
            </a>
        </div>
    </template>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAR3cjd3d4Bnzhv-iai20yeEVBSzu5k1Qo",
          authDomain: "sua-viagem-aqui-v2.firebaseapp.com",
          projectId: "sua-viagem-aqui-v2",
          storageBucket: "sua-viagem-aqui-v2.appspot.com",
          messagingSenderId: "508306740983",
          appId: "1:508306740983:web:c1ce3d41e098416a5f2",
          measurementId: "G-FZKQ66PXFH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const loader = document.getElementById('loader');
        const pageContent = document.getElementById('page-content');
        const profileContainer = document.getElementById('profile-container');
        const notFoundTemplate = document.getElementById('not-found-template');

        // Função para obter o ID do parceiro do URL
        function getPartnerIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        // Função para renderizar o perfil do parceiro
        function renderPartnerProfile(partnerData) {
            document.title = `${partnerData.businessName} - Sua Viagem Aqui`;

            // Gera os botões de contacto apenas se a informação existir
            let contactButtonsHTML = '';
            if (partnerData.whatsapp) {
                contactButtonsHTML += `<a href="https://wa.me/${partnerData.whatsapp.replace(/\D/g,'')}" target="_blank" class="btn-contact btn-whatsapp"><i class="fab fa-whatsapp mr-2"></i>WhatsApp</a>`;
            }
            if (partnerData.instagram) {
                contactButtonsHTML += `<a href="https://instagram.com/${partnerData.instagram}" target="_blank" class="btn-contact btn-instagram"><i class="fab fa-instagram mr-2"></i>Instagram</a>`;
            }
             if (partnerData.phone) {
                contactButtonsHTML += `<a href="tel:${partnerData.phone}" class="btn-contact btn-phone"><i class="fas fa-phone mr-2"></i>Telefone</a>`;
            }

            // Gera a galeria de imagens
            let galleryHTML = '';
            if (partnerData.galleryImages && partnerData.galleryImages.length > 0) {
                partnerData.galleryImages.forEach(image => {
                    galleryHTML += `<div class="aspect-w-1 aspect-h-1"><img src="${image.url}" alt="Galeria de ${partnerData.businessName}" class="w-full h-full object-cover rounded-lg"></div>`;
                });
            }

            const coverImageUrl = partnerData.coverImageUrl || 'https://placehold.co/1200x400/161B22/E6EDF3?text=Perfil';

            profileContainer.innerHTML = `
                <div class="bg-custom-card rounded-lg overflow-hidden border border-custom">
                    <!-- Imagem de Capa -->
                    <div class="h-48 md:h-64 bg-cover bg-center" style="background-image: url('${coverImageUrl}')"></div>

                    <div class="p-6 md:p-8">
                        <!-- Cabeçalho do Perfil -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div>
                                <h1 class="text-3xl md:text-4xl font-bold text-white">${partnerData.businessName}</h1>
                                <p class="text-orange-500 text-lg capitalize mt-1">${partnerData.category} em ${partnerData.city}</p>
                            </div>
                            <div class="mt-4 md:mt-0 flex items-center space-x-3">
                                ${contactButtonsHTML}
                            </div>
                        </div>

                        <!-- Descrição -->
                        <div class="mt-8 border-t border-custom pt-6">
                            <h2 class="text-2xl font-bold text-white mb-3">Sobre</h2>
                            <p class="text-gray-400 leading-relaxed whitespace-pre-line">${partnerData.description || 'Nenhuma descrição fornecida.'}</p>
                        </div>

                        <!-- Galeria -->
                        ${galleryHTML ? `
                        <div class="mt-8 border-t border-custom pt-6">
                            <h2 class="text-2xl font-bold text-white mb-4">Galeria</h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                ${galleryHTML}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Função para mostrar a mensagem de "não encontrado"
        function renderNotFound() {
            profileContainer.innerHTML = notFoundTemplate.innerHTML;
        }

        // Função principal para carregar a página
        async function loadPage() {
            const partnerId = getPartnerIdFromURL();

            if (!partnerId) {
                renderNotFound();
            } else {
                try {
                    const docRef = doc(db, "partners", partnerId);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists() && docSnap.data().status === 'aprovado') {
                        renderPartnerProfile(docSnap.data());
                    } else {
                        renderNotFound();
                    }
                } catch (error) {
                    console.error("Erro ao buscar parceiro:", error);
                    renderNotFound();
                }
            }
            
            // Mostra o conteúdo da página
            loader.style.display = 'none';
            pageContent.style.display = 'block';
        }

        loadPage();
    </script>
</body>
</html>
